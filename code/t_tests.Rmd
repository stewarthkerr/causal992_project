---
title: "t-tests"
author: "Jeanne Li, Susan Glenn, Stewart Kerr, Jingcheng Xu"
date: "March 2020"
header-includes:
  - \usepackage{bm}
  - \usepackage{amsmath}
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=75),tidy=TRUE, echo = TRUE)
```

# Goal of document
We run t-test like we previously had done, but this time after implementing CART. So we run paired t-test only on the matched sets resulting from CART. 

'for_t_test.csv' is a copy of 'results-final.csv' but with the outcome column in the format:

A subject's outcome is 1 if they outlived their matched counterpart and is 0 if they died first. When both people in a pair lived to the end of data collection or died in the same wave, this pair was assigned an outcome of -1 and not used in our t-test.

# Preparing the dataset
```{r}
# 'matched_pairs.CART.csv' contain the pair_ID of the matched sets after running CART
cart_pairs <- read.csv("../data/matched_pairs.CART.csv")
```

We remove the pairs that died in the same wave and get a matrix (called 'Ymatrix') that has 3 columns: "outcome_of_treated", "outcome_of_control", "paired_ID"
```{r}
result_matrix <- read.csv(file="../data/for_t_test.csv", header=TRUE, sep=",")
nonneg_outcomes <- subset(result_matrix,result_matrix$outcome!=-1)

Ymatrix <- matrix(0,nrow=length(nonneg_outcomes$pair_ID)/2,ncol=3) 

k=0
for (i in unique(nonneg_outcomes$pair_ID)){
k=k+1
  for (j in which(result_matrix$pair_ID %in% i)){
    Ymatrix[k,3] = result_matrix$pair_ID[j]
    if (result_matrix$treated[j]==1){
      Ymatrix[k,1] = result_matrix$outcome[j]
    } else {
      Ymatrix[k,2] = result_matrix$outcome[j]
    }
  }
}

colnames(Ymatrix) = c("outcome_of_treated", "outcome_of_control", "paired_ID")
Ymatrix <- as.data.frame(Ymatrix)
```

Now we remove the matched sets of 'Ymatrix' that are not a part of our CART result.
```{r}
t_test_matrix <- subset(Ymatrix,Ymatrix$paired_ID %in% cart_pairs$pair_ID)
```

# Running the t-test
```{r}
t.test(t_test_matrix$outcome_of_treated, t_test_matrix$outcome_of_control, paired=TRUE)
```